openapi: 3.0.3
info:
  title: Marketplace API
  description: |-
    API для управления маркетплейсом
    - Управление товарами (создание, удаление, поиск, обновление, получение списка)
    - Авторизация и регистрация пользователей
  version: 1.0.0

servers:
  - url: /homeWorkThree
    description: Основной сервер

paths:
  # ===== ЭНДПОИНТЫ ДЛЯ ПРОДУКТОВ =====
  /marketplace/products/create:
    post:
      tags:
        - Products
      summary: Создать новый товар
      description: |
        Создание нового товара в системе.
        **Требует:** Авторизация + права администратора
      operationId: createProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreateRequest'
            examples:
              example1:
                summary: Пример создания товара
                value:
                  name: "iPhone 15"
                  category: "Electronics"
                  brand: "Apple"
                  price: "999.99"
                  description: "Новый смартфон"
      responses:
        '201':
          description: Товар успешно создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductCreatedResponse'
        '400':
          description: Неверные данные запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Недостаточно прав (требуется администратор)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /marketplace/products/delete:
    post:
      tags:
        - Products
      summary: Удалить товар
      description: |
        Удаление товара по ID.
        **Требует:** Авторизация + права администратора
      operationId: deleteProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductDeleteRequest'
            examples:
              example1:
                summary: Пример удаления товара
                value:
                  id: 123
      responses:
        '200':
          description: Товар успешно удален
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDeletedResponse'
        '400':
          description: Неверный ID товара
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Недостаточно прав
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /marketplace/products/list:
    get:
      tags:
        - Products
      summary: Получить все товары
      description: |
        Получение списка всех товаров.
        **Требует:** Авторизация
      operationId: getAllProducts
      responses:
        '200':
          description: Список товаров получен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductListResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /marketplace/products/search:
    post:
      tags:
        - Products
      summary: Поиск товаров
      description: |
        Поиск товаров по фильтрам (название, категория, бренд, цена).
        **Требует:** Авторизация
      operationId: searchProducts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductSearchRequest'
            examples:
              example1:
                summary: Пример поиска
                value:
                  keyword: "phone"
                  category: "Electronics"
                  brand: "Apple"
                  minPrice: "500"
                  maxPrice: "1000"
      responses:
        '200':
          description: Результаты поиска
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductSearchResponse'
        '400':
          description: Неверные параметры поиска
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /marketplace/products/update:
    post:
      tags:
        - Products
      summary: Обновить товар
      description: |
        Обновление информации о товаре.
        **Требует:** Авторизация + права администратора
      operationId: updateProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdateRequest'
            examples:
              example1:
                summary: Пример обновления
                value:
                  id: 123
                  name: "iPhone 15 Pro"
                  category: "Electronics"
                  brand: "Apple"
                  price: "1199.99"
                  description: "Обновленная версия"
      responses:
        '200':
          description: Товар успешно обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductUpdatedResponse'
        '400':
          description: Неверные данные для обновления
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Недостаточно прав
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ===== ЭНДПОИНТЫ АУТЕНТИФИКАЦИИ =====
  /marketplace/auth/login:
    post:
      tags:
        - Authentication
      summary: Вход в систему
      description: Авторизация пользователя
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              example1:
                summary: Пример входа
                value:
                  login: "admin"
                  password: "password123"
      responses:
        '200':
          description: Успешный вход
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Неверные данные
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Неверный логин или пароль
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /marketplace/auth/logout:
    post:
      tags:
        - Authentication
      summary: Выход из системы
      description: Завершение сессии пользователя. Требует авторизации.
      operationId: logout
      responses:
        '200':
          description: Успешный выход
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /marketplace/auth/register:
    post:
      tags:
        - Authentication
      summary: Регистрация пользователя
      description: Создание нового аккаунта
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              example1:
                summary: Пример регистрации
                value:
                  login: "newuser"
                  password: "securepassword"
                  role: "USER"
      responses:
        '200':
          description: Пользователь зарегистрирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          description: Неверные данные регистрации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Ошибка регистрации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    # ===== СХЕМЫ ЗАПРОСОВ =====
    ProductCreateRequest:
      type: object
      required:
        - name
        - price
      properties:
        name:
          type: string
          example: "iPhone 15"
        category:
          type: string
          example: "Electronics"
        brand:
          type: string
          example: "Apple"
        price:
          type: string
          example: "999.99"
        description:
          type: string
          example: "Новый смартфон"

    ProductDeleteRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int64
          example: 123

    ProductSearchRequest:
      type: object
      properties:
        keyword:
          type: string
          example: "phone"
        category:
          type: string
          example: "Electronics"
        brand:
          type: string
          example: "Apple"
        minPrice:
          type: string
          example: "500"
        maxPrice:
          type: string
          example: "1000"

    ProductUpdateRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: int64
          example: 123
        name:
          type: string
          example: "iPhone 15 Pro"
        category:
          type: string
          example: "Electronics"
        brand:
          type: string
          example: "Apple"
        price:
          type: string
          example: "1199.99"
        description:
          type: string
          example: "Обновленная версия"

    LoginRequest:
      type: object
      required:
        - login
        - password
      properties:
        login:
          type: string
          example: "admin"
        password:
          type: string
          format: password
          example: "password123"

    RegisterRequest:
      type: object
      required:
        - login
        - password
        - role
      properties:
        login:
          type: string
          example: "newuser"
        password:
          type: string
          format: password
          example: "securepassword"
        role:
          type: string
          enum: [USER, ADMIN]
          example: "USER"

    # ===== СХЕМЫ ОТВЕТОВ =====
    ProductCreatedResponse:
      type: object
      properties:
        productId:
          type: integer
          format: int64
          example: 123
        message:
          type: string
          example: "Product created successfully"

    ProductDeletedResponse:
      type: object
      properties:
        productId:
          type: integer
          format: int64
          example: 123
        message:
          type: string
          example: "Product deleted successfully"

    ProductListResponse:
      type: object
      properties:
        products:
          type: array
          items:
            $ref: '#/components/schemas/ProductResponse'

    ProductSearchResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/ProductResponse'

    ProductUpdatedResponse:
      type: object
      properties:
        productId:
          type: integer
          format: int64
          example: 123
        message:
          type: string
          example: "Product updated successfully"

    ProductResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 123
        name:
          type: string
          example: "iPhone 15"
        category:
          type: string
          example: "Electronics"
        brand:
          type: string
          example: "Apple"
        price:
          type: number
          format: double
          example: 999.99
        description:
          type: string
          example: "Новый смартфон"

    LoginResponse:
      type: object
      properties:
        message:
          type: string
          example: "Login successful"

    LogoutResponse:
      type: object
      properties:
        message:
          type: string
          example: "Logout successful"

    RegisterResponse:
      type: object
      properties:
        login:
          type: string
          example: "newuser"
        role:
          type: string
          example: "USER"

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: "VALIDATION_FAILED"
        details:
          type: array
          items:
            type: string
          example: ["Field 'name' is required"]