## Консольное Java-приложение для управления каталогом товаров с CRUD, поиском/фильтрацией, авторизацией, аудитом и простым файлом-хранилищем.

### Содержание
1. [Архитектура и разделение ответственности](#архитектура-и-разделение-ответственности)
2. [Поиск и фильтрация](#поиск-и-фильтрация)
3. [Кэширование (LRU)](#кэширование-lru)
4. [Сохранение между запусками](#сохранение-между-запусками)
5. [Метрики](#метрики)
6. [Безопасность / авторизация](#безопасность--авторизация)
7. [Как расширить до REST API](#как-расширить-до-rest-api)
8. [Сборка и запуск (runnable jar)](#сборка-и-запуск-runnable---jar)

## Архитектура и разделение ответственности
**Слои приложения**:
- UI - оболочка для ввода и вывода данных, использует ConsoleUtils для безопасного чтения, не содержит бизнес-логики.
- Controller - принимает вызовы от UI (или в будущем от REST), проверяет авторизацию/роли, вызывает сервисы и ведёт аудит. Контроллеры принимают объект User (current user) и делают проверку роли (Role.ADMIN/Role.USER).
- Service - реализация бизнес-логики: CRUD, поиск, кэширование, регистрация/логин, логирование действий. Сервисы не знают о консоли.
- Repository - хранение в памяти + индексы (category/brand/price). Репозиторий предоставляет методы save, delete, findById, findAll, индексы и методы загрузки/сохранения в файл.

**Такое разделение позволяет**:

1. Тестировать логику отдельно от UI;
2. Легко заменить UI;
3. Заменить хранилище.

## Поиск и фильтрация
Поиск реализован с возможностью фильтрации по ключевому слову, категории, бренду и ценовому диапазону. Фильтры по бренду и категории чувствительны к регистру и ищут точные совпадения. Поиск по ключевому слову нечувствителен к регистру и проверяет вхождение подстроки в название, описание, категорию или бренд, он происходит после всех остальных фильтров, из-за чего не критично влияет на скорость.
Для каждого фильтра построены индексы, что позволяет быстро отбирать только релевантные товары, избегая линейного прохода по всей коллекции. Алгоритм использует операции пересечения множеств, что обеспечивает высокую скорость фильтрации даже при большом количестве товаров.
Для цен используется TreeMap, что ускоряет взятие диапазона. 

## Кэширование (LRU)
Для ускорения повторных запросов реализован LRU-кэш (Least Recently Used).
Он хранит результаты последних поисковых запросов и автоматически удаляет наименее используемые записи при превышении лимита.
Это значительно сокращает время отклика при повторных поисках с одинаковыми фильтрами.

## Сохранение между запусками
Для сохранения состояния каталога между перезапусками используется файловое хранилище (products.txt, users.txt).
Данные сериализуются в текстовом формате и загружаются при запуске программы.

## Метрики
В приложение встроены базовые метрики:

- количество найденных товаров,
- время выполнения запроса в миллисекундах.

Это позволяет оценить производительность поиска и эффективность фильтрации.

## Безопасность / авторизация
Приложение содержит простую систему учётных записей и разграничения прав доступа:

- **Регистрация и вход** — пользователи регистрируются через консольный интерфейс; данные (логин, пароль, роль) сохраняются в users.txt.
- **Роли** — каждая учётная запись имеет роль. Роли объявлены как enum Role и используются в контроллере для проверки прав.
    - ADMIN — может добавлять, редактировать и удалять товары.
    - USER — может просматривать и искать товары.
- **Проверка прав** — проверка прав выполнена в контроллере (входящая проверка User), а не в сервисах, что упрощает миграцию на REST.
- **Хранение паролей** — для простоты реализации пароли хранятся в явном виде в файле. 

## Как расширить до REST API
Приложение спроектировано так, чтобы минимизировать работу при переходе на REST:

- **Разделение слоев**: UI (ConsoleUI) → Controller → Service → Repository. Контроллеры инкапсулируют проверку ролей и вызывают сервисы: в REST-реализации их можно заменить на HTTP-контроллеры, которые будут извлекать User из токена.
- **Переиспользование сервисов**: сервисы содержат бизнес-логику и не зависят от консольного ввода — их можно подключить к любому веб-слою.
- **Хранилище**: репозитории инкапсулируют доступ к данным. Для масштабирования достаточно заменить файловую реализацию на реализацию, работающую с базой данных, например JPA, интерфейсы сервисов останутся прежними.

## Сборка и запуск (runnable - jar)
Проект настроен на сборку исполняемого JAR (runnable jar) через maven-jar-plugin, что обеспечивает простое развёртывание и проверку. Все команды выполнять из корневой директории проекта.

Сборка:
```bash
mvn clean package
```
Рекомендуется запускать в cmd, переключите консоль на UTF-8 (для cmd):
```bash
chcp 65001
```
**Важно**: иначе русский текст в меню и товарах будет отображаться некорректно.

Приложение можно запустить напрямую, так как в pom.xml указан Main-Class. Запуск:
```bash
java -Dfile.encoding=UTF-8 -Dsun.stdout.encoding=UTF-8 -Dsun.stderr.encoding=UTF-8 -jar target/task1-0.0.1.jar
```
**Важно**: параметры нужны для корректного отображения русских символов в консоли и записи в файл.
Или же можно запустить программу в Intellij IDEA с помощью зеленой кнопки, терминал встроенный в Intellij IDEA корректно все выводит. 